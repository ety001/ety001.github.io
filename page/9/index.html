<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon.ico">
  <link rel="mask-icon" href="/img/favicon.ico" color="#222">
  <link rel="manifest" href="/site.webmanifest">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.akawa.ink","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="ETY001的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Akawa">
<meta property="og:url" content="https://blog.akawa.ink/page/9/index.html">
<meta property="og:site_name" content="Akawa">
<meta property="og:description" content="ETY001的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ETY001">
<meta property="article:tag" content="ETY001, akawa, php, vuejs, javascript, docker, steemit, bitshares">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.akawa.ink/page/9/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/9/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Akawa - ETY001的博客</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-60YZJHHP9K"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-60YZJHHP9K","only_pageview":false,"measure_protocol_api_secret":null}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>







<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7536831447654223" crossorigin="anonymous"></script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Akawa" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Akawa</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">ETY001的博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-生活"><a href="/life" rel="section"><i class="fa fa-bicycle fa-fw"></i>生活</a></li><li class="menu-item menu-item-关于"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-dm实验室"><a href="/lab/" rel="section"><i class="fa fa-gear fa-fw"></i>DM实验室</a></li><li class="menu-item menu-item-捐助"><a href="/donate/" rel="section"><i class="fa fa-star fa-fw"></i>捐助</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-标签云"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签云</a></li><li class="menu-item menu-item-归档"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-友链"><a href="/friendsblog/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ETY001"
      src="/img/logo.jpg">
  <p class="site-author-name" itemprop="name">ETY001</p>
  <div class="site-description" itemprop="description">ETY001的博客</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">482</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">68</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ety001" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ety001" rel="noopener me" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:work@akawa.ink" title="E-Mail → mailto:work@akawa.ink" rel="noopener me" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/ety001" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;ety001" rel="noopener me" target="_blank"><i class="weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/ety001" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;ety001" rel="noopener me" target="_blank"><i class="twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2019/11/06/accident-by-memory.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/11/06/accident-by-memory.html" class="post-title-link" itemprop="url">由四条内存引起的事故</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-11-07 00:00:00" itemprop="dateCreated datePublished" datetime="2019-11-07T00:00:00+08:00">2019-11-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>昨天新买的四条服务器内存到了，于是早上去安装一下。</p>
<p>很不幸的是，关机安装完内存条后，系统起不来。第一反应是内存没有插好。<br>拔下所有新装的内存，先试试能不能开机，结果不能。</p>
<p>系统一直卡在一个光标闪烁的状态。</p>
<p>由于一直就很想重做这个服务器的系统，当时装的时候，忘记做LVM了，<br>所以这次故障也懒得修了，直接开始重做系统。</p>
<p>花了2个小时，把基础系统做完，重启了几遍看看有没有什么问题，一切正常。</p>
<p>看到内存插满主板达到256G顶值后，心里美滋滋，心想这下可以大开杀戒了。</p>
<p><img src="/upload/20191107/cJ64E7n1icFTMST0S7wfmLxJNeKcdmhatHVTRGkX.png"></p>
<p>结果下午回到家，没安装几个服务，主机就挂了。</p>
<p>由于我的服务器电源连接在米家的电源开关上，所以我进行了远程重新断电上电操作。<br>通过米家可以看到机器自动启动成功了，但是一直连不上，怕是系统又进不去了。</p>
<p>折腾了半天没有成功后，不得不再回去看看是什么情况。</p>
<p>重新接上显示器后，发现跟早上的情况一个样，目测应该是硬盘有问题。打开 BIOS 看了下，果然</p>
<p><img src="/upload/20191107/Nvjm1ifcDd4IWZ9rgLWZbjcjcc9v8nHLX3XvJe24.png"></p>
<p>一共三块硬盘，只识别出来了两块，最关键的那块带这 grub 引导的硬盘没有识别出来。</p>
<p>考虑到新系统上了 LVM ，我这块没有识别出来的硬盘（金士顿）和另外一块东芝的做成了一个逻辑组，<br>所以在考虑能不能把金士顿这块从逻辑组里踢出去。</p>
<p>但是我重启引导进U盘里的系统后，发现并没有金士顿那个硬盘</p>
<p><img src="/upload/20191107/68U5TBj6LcWNAf1yEGo6m7KBhhQ59X8oVJQw0omm.png"></p>
<p>有点慌！既然系统间歇性能启动起来，那看来硬盘坏的不严重。<br>估计重启几次，肯定会有一次能挂上。在重启了三四次后，终于检测出来了。</p>
<p><img src="/upload/20191107/7NwjgoAD7rOxTbLNU5WN6MqIZB4C1cqSKFBQkQkU.png"></p>
<p><strong>好，既然监测出来了，让我先理顺一下目前的情况。</strong></p>
<p>1.当前是金士顿（<code>/dev/sdb1</code>）和东芝（<code>/dev/sdc1</code>）做了一个逻辑组 <code>/dev/vssd</code></p>
<p><img src="/upload/20191107/Xr94c8OiTCW07NmdItTrFkKLu5bsYZAxjr23guYP.png"></p>
<p>2.然后在 <code>/dev/vssd</code> 这个逻辑组上划分了两个逻辑卷 <code>/dev/vssd/vboot</code> 和 <code>/dev/vssd/vmain</code></p>
<p><img src="/upload/20191107/cHbNU0bzz2MwSDjfRi8ocJoGwncWPNAkm5Fw0jKZ.png"></p>
<p>3.系统有两个分区，<code>/</code> 挂在 <code>/dev/vssd/vmain</code> 上，<code>/boot</code> 挂在 <code>/dev/vssd/vboot</code> 上。<br>尝试了挂载 <code>/</code> 和 <code>/boot</code> ，发现 <code>/</code> 挂载成功，<code>/boot</code> 挂载失败，提示磁盘有错误。<br>系统目前不超过 7G 大。</p>
<p><img src="/upload/20191107/f7GGEkqToEkeDf8rTaQU8N3yisEOLov21OYquGl0.png"></p>
<p><strong>情况理顺完，我们的思路也就有了。</strong></p>
<ol>
<li>把 <code>/dev/vssd/vmain</code> 缩小到 <code>/dev/sdc1</code> 的大小以内，</li>
<li>从 <code>/dev/vssd</code> 中把 <code>/dev/vssd/vboot</code> 删除，</li>
<li>把 <code>/dev/sdb1</code> 这个 <code>pv</code> 从 <code>/dev/vssd</code> 逻辑组中删除，这个时候，逻辑组里就没有金士顿硬盘了，</li>
<li>在逻辑组 <code>/dev/vssd</code> 中再新建一个 <code>/dev/vssd/vboot</code> 逻辑卷，</li>
<li>重新调整 <code>/dev/vssd/vmain</code> 的大小，让其把剩余所有的空间占有，</li>
<li>重新挂在 <code>/dev/vssd/vmain</code> 和 <code>/dev/vssd/vboot</code>，在 <code>/dev/vssd/vboot</code> 上安装内核，</li>
<li>重新生成 <code>fstab</code></li>
<li>重新安装 <code>Grub</code> 到 <code>/dev/sdc</code> 上，并生成新的 <code>grub.cfg</code> 存储到 <code>/dev/vssd/vboot</code> 上。</li>
</ol>
<p><strong>开始实施。</strong></p>
<p>1.缩小 <code>/dev/vssd/vmain</code>，需要先监测才能缩小</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">w2fsck -f /dev/vssd/vmain</span><br></pre></td></tr></table></figure>

<p>执行缩小，由于我的东芝是400多G，那么我只要缩小到400G内就好了，懒得计算，取了个整 300G</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 先缩小文件系统</span><br><span class="line">resize2fs /dev/vssd/vmain 300G</span><br><span class="line"># 再缩小逻辑卷</span><br><span class="line">lvreduce -L 300G /dev/vssd/vmain</span><br></pre></td></tr></table></figure>

<p>三步操作如下图</p>
<p><img src="/upload/20191107/9Gyjtf9HMeRTAoNrvJBiS10LNLA7jdnE3mZ5GjD2.png"></p>
<p>2.从 <code>/dev/vssd</code> 中把 <code>/dev/vssd/vboot</code> 删除，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvremove /dev/vssd/vboot</span><br></pre></td></tr></table></figure>

<p>3.从逻辑组中移除金士顿硬盘</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgreduce vssd /dev/sdb1</span><br></pre></td></tr></table></figure>

<p>操作完可以看到逻辑组（VG）里只有一个 PV 了，并且 VG 的容量跟东芝的硬盘一样大了</p>
<p><img src="/upload/20191107/mpbFv6uTk1mzZLsYCNNRVCyGFZxCCWrwrihrUIAT.png"></p>
<p>4.新建 <code>/dev/vssd/vboot</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvcreate -L 200M vssd -n vboot</span><br></pre></td></tr></table></figure>

<p>5.扩容 <code>/dev/vssd/vmain</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 注意这里参数是小写L</span><br><span class="line">lvextend -l +100%FREE /dev/vssd/vmain</span><br></pre></td></tr></table></figure>

<p><img src="/upload/20191107/T9iSiBSmcR1wcAojApuQwD2JJAEMvRJIrMIQULyl.png"></p>
<p>6.格式化 <code>/dev/vssd/vboot</code> 后，重新挂载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext2 /dev/vssd/vboot</span><br><span class="line">mount /dev/vssd/vboot /mnt/boot</span><br></pre></td></tr></table></figure>

<p><img src="/upload/20191107/HoFpTcLPLvKDswKBRNYdWrP1uf9s8GqueyJ7sP8s.png"></p>
<p>重新安装内核</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pacstrap /mnt linux linux-firmware</span><br></pre></td></tr></table></figure>

<p><img src="/upload/20191107/vXuQTb0rKjCpuPJ6Z2tf3SRj9ivOqhHitm3OfNrK.png"></p>
<p>7.生成新的 <code>fstab</code></p>
<p>由于 <code>/dev/vssd/vboot</code> 是新创建的，所以原来分区的 <code>UUID</code> 也就不存在了，因此需要更新 <code>fstab</code>，<br>否则启动的时候会找不到分区。（通过截图可以看到原来的 <code>UUID</code>）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">genfstab -U /mnt &gt; /mnt/etc/fstab</span><br></pre></td></tr></table></figure>

<p><img src="/upload/20191107/nYXNhrTSKrRZvjcq11R7Y5mvaSekRcf9pLg0sfJo.png"></p>
<p>8.重新安装 Grub ，生成新的 <code>grub.cfg</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 进入chroot</span><br><span class="line">arch-chroot /mnt</span><br><span class="line"># 安装 grub 到 /dev/sdc</span><br><span class="line">grub-install --target=i386-pc /dev/sdc</span><br><span class="line"># 生成新的 grub.cfg</span><br><span class="line">grub-mkconfig -o /boot/grub/grub.cfg</span><br></pre></td></tr></table></figure>

<p><img src="/upload/20191107/djob2p07zHs9gfNeV9ce89IN7s5BGySE0Fw5plsb.png"></p>
<p>9.所有操作结束后，退出 <code>chroot</code>，卸载所有已挂载分区，重启。</p>
<h4 id="完美启动！！！！"><a href="#完美启动！！！！" class="headerlink" title="完美启动！！！！"></a>完美启动！！！！</h4>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2019/11/04/huobi-docker-sdk.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/11/04/huobi-docker-sdk.html" class="post-title-link" itemprop="url">用Docker封装了火币的python sdk</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-11-05 00:00:00" itemprop="dateCreated datePublished" datetime="2019-11-05T00:00:00+08:00">2019-11-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>天天盯盘实在是有点吃不消了，有些工作还是需要用机器来完成。<br>由于已经习惯了靠 Docker 部署，所以先把基础工作做好，把火币<br>的 python sdk 环境封装个 Docker 基础包。</p>
<h1 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">FROM alpine:3.9</span><br><span class="line">WORKDIR /app</span><br><span class="line">ARG TAG=1.0.5</span><br><span class="line">RUN apk --no-cache add git python3 &amp;&amp; \</span><br><span class="line">    git clone https://github.com/HuobiRDCenter/huobi_Python.git &amp;&amp; \</span><br><span class="line">    cd huobi_Python &amp;&amp; \</span><br><span class="line">    git checkout $&#123;TAG&#125; &amp;&amp; \</span><br><span class="line">    python3 setup.py install &amp;&amp; \</span><br><span class="line">    cd .. &amp;&amp; \</span><br><span class="line">    rm -rf huobi_Python</span><br><span class="line">CMD [&quot;pwd&quot;]</span><br></pre></td></tr></table></figure>

<p>编译的时候，可以通过 ARG 来控制你要使用的版本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build --build-arg TAG=1.0.5 -t ety001/huobi-lib:1.0.5 .</span><br></pre></td></tr></table></figure>

<h1 id="测试一下"><a href="#测试一下" class="headerlink" title="测试一下"></a>测试一下</h1><p>在当前目录创建个测试文件 <code>a.py</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from huobi import SubscriptionClient</span><br><span class="line">from huobi.model import *</span><br><span class="line">from huobi.exception.huobiapiexception import HuobiApiException</span><br><span class="line">from huobi import RequestClient</span><br><span class="line"></span><br><span class="line">request_client = RequestClient()</span><br><span class="line"></span><br><span class="line"># Get the timestamp from Huobi server and print on console</span><br><span class="line">timestamp = request_client.get_exchange_timestamp</span><br><span class="line">print(timestamp)</span><br><span class="line"></span><br><span class="line"># Get the latest btcusdt‘s candlestick data and print the highest price on console</span><br><span class="line">candlestick_list = request_client.get_latest_candlestick(&quot;btcusdt&quot;, CandlestickInterval.DAY1, 20)</span><br><span class="line">for item in candlestick_list:</span><br><span class="line">    print(item.high)</span><br></pre></td></tr></table></figure>

<p>启动一个临时容器，测试一下我们的 SDK 是否安装正确</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm -v $(pwd):/app ety001/huobi-lib:1.0.5 python3 /app/a.py</span><br></pre></td></tr></table></figure>

<p>如果环境正确，则会正常输出数据。</p>
<p>OVER！接下来就要去研究下火币的各个 API 了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2019/11/01/flutter-android-internet.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/11/01/flutter-android-internet.html" class="post-title-link" itemprop="url">Flutter 编译为 APK Release时无法联网</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-11-02 00:00:00" itemprop="dateCreated datePublished" datetime="2019-11-02T00:00:00+08:00">2019-11-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>今天完成了我第一个 Flutter App —— <a target="_blank" rel="noopener" href="https://fir.im/yhu7">网络剪切板</a>。<br>当我满怀激动的编译出 Release 版本后，发现程序并不能联网。</p>
<p>经过搜索发现，原来要想联网需要自己手动去 <code>AndroidManifest.xml</code> 里添加下面的权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>我觉得 Flutter 的这种方式，让人觉得很恶心，这些工作不应该是 Flutter 自身的工具集<br>来完成的事情吗？为什么需要用户再去手动配置权限？不可思议。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2019/10/30/genymotion-setup.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/10/30/genymotion-setup.html" class="post-title-link" itemprop="url">上手 Genymotion</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-10-31 00:00:00" itemprop="dateCreated datePublished" datetime="2019-10-31T00:00:00+08:00">2019-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>由于最近需要在模拟器里搞事情，Genymotion 是个很好用的模拟器，<br>然而初始状态下，并不好用，需要安装很多必备软件。<br>这篇会简述下大致的步骤。</p>
<h3 id="1-安装-Genymotion"><a href="#1-安装-Genymotion" class="headerlink" title="1. 安装 Genymotion"></a>1. 安装 Genymotion</h3><p>具体安装过程请去 Genymotion 的官网查看。<br>安装好以后，安装 <code>Google Nexus 5X 8.0-API26</code> 这个版本。</p>
<h3 id="2-安装-OpenGapps"><a href="#2-安装-OpenGapps" class="headerlink" title="2. 安装 OpenGapps"></a>2. 安装 OpenGapps</h3><p>安装 OpenGapps 的目的是为了使用 Google Play Store 来安装浏览器。<br>在 Genymotion 的 3.0.3 版本中，已经自带了 OpenGapps 的安装途径，<br>就在模拟器的控制栏上，如图所示</p>
<p><img src="/upload/20191031/zSdTodxe7HzkorbjbeRDQwU3j5yrB6JaTiOsr467.png"></p>
<p>点击后，按照提示即可完成安装，重启后，就可以登录 Google Play Store 来安装个浏览器了。</p>
<h3 id="3-安装-Genymotion-ARM-Translation"><a href="#3-安装-Genymotion-ARM-Translation" class="headerlink" title="3. 安装 Genymotion ARM Translation"></a>3. 安装 Genymotion ARM Translation</h3><p>由于 Genymotion 的模拟器是 x86 架构编译的 Android 系统，有一些 App 是不支持 X86 的，<br>所以我们需要安装一个翻译器。</p>
<p>访问 <a target="_blank" rel="noopener" href="https://github.com/m9rco/Genymotion_ARM_Translation">https://github.com/m9rco/Genymotion_ARM_Translation</a> 这里，<br>找到 Android 8.0 版本的下载包，下载后直接把 zip 包拖拽进模拟器里，<br>按照提示信息安装即可，完成后重启模拟器。</p>
<h3 id="4-安装-XPosed-框架"><a href="#4-安装-XPosed-框架" class="headerlink" title="4. 安装 XPosed 框架"></a>4. 安装 XPosed 框架</h3><p>访问 <a target="_blank" rel="noopener" href="https://forum.xda-developers.com/showthread.php?t=3034811">https://forum.xda-developers.com/showthread.php?t=3034811</a> ，<br>在这个页面，下载 <code>XposedInstaller_*.apk</code>。</p>
<p>然后访问 <a target="_blank" rel="noopener" href="https://dl-xda.xposed.info/framework/">https://dl-xda.xposed.info/framework/</a> ，<br>依次打开 sdk26 &#x2F; x86 目录，下载最新的 zip 包。下载完成后，拖拽入模拟器安装。</p>
<p>安装完重启模拟器，再拖入 <code>XposedInstaller_*.apk</code> 进行安装，完成后，重启模拟器。</p>
<h3 id="这样一些基础软件就都完成了安装，再使用起来就方便了很多。"><a href="#这样一些基础软件就都完成了安装，再使用起来就方便了很多。" class="headerlink" title="这样一些基础软件就都完成了安装，再使用起来就方便了很多。"></a>这样一些基础软件就都完成了安装，再使用起来就方便了很多。</h3>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2019/10/28/add-bts-trade-game.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/10/28/add-bts-trade-game.html" class="post-title-link" itemprop="url">我也加入了bitshares交易赛的战局</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-10-29 00:00:00" itemprop="dateCreated datePublished" datetime="2019-10-29T00:00:00+08:00">2019-10-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>具体的比赛贴子：<a target="_blank" rel="noopener" href="https://bitsharestalk.org/index.php?topic=29665.0">https://bitsharestalk.org/index.php?topic=29665.0</a></p>
<p>使用我之前开发的机器人参赛非常简单。这里是之前发布机器人时的贴子：<a href="/2019/05/22/bts-trade-bots.html">https://akawa.ink/2019/05/22/bts-trade-bots.html</a> 。</p>
<p>本教程是在Linux下运行。</p>
<p>首先，需要有Docker环境，具体Docker安装方法请参考Docker官方网站。</p>
<p>然后，创建一个环境变量文件，用于配置你的机器人，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 节点地址</span><br><span class="line">API_URL=wss://bts.open.icowallet.net/ws</span><br><span class="line"># 账号名</span><br><span class="line">ACCOUNT=</span><br><span class="line"># 账号active私钥</span><br><span class="line">PRIV_KEY=</span><br><span class="line"># 钱包密码</span><br><span class="line">PASSWD=123456</span><br><span class="line"># 做市市场 Quote:Base</span><br><span class="line">MARKET=GDEX.BTC:BTS</span><br><span class="line"># 买单价格比率</span><br><span class="line">BUY_RATE=0.01</span><br><span class="line"># 卖单价格比率</span><br><span class="line">SELL_RATE=0.01</span><br><span class="line"># 花费base的数量</span><br><span class="line">BUY_AMOUNT=100</span><br><span class="line"># 得到base的数量</span><br><span class="line">SELL_AMOUNT=100</span><br><span class="line"># base货币最大持有量</span><br><span class="line">BASE_MAX=2000</span><br><span class="line"># quote货币最大持有量</span><br><span class="line">QUOTE_MAX=2000</span><br></pre></td></tr></table></figure>

<p>假设该文件名为 <code>bts_bts</code>。</p>
<p>启动机器人的命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd \</span><br><span class="line"> --name bot1 \</span><br><span class="line"> --restart always \</span><br><span class="line"> --env-file btc_bts \</span><br><span class="line"> ety001/btsbots-cli:latest</span><br></pre></td></tr></table></figure>

<p>启动之后，可以用 <code>docker logs -f --tail 100 bot1</code> 来查看机器人的运行状态。</p>
<p>如果想要停止并删除机器人，执行 <code>docker stop bot1 &amp;&amp; docker rm bot1</code> 即可。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2019/10/10/bitshares-es-node-add-kibana.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/10/10/bitshares-es-node-add-kibana.html" class="post-title-link" itemprop="url">对之前的 Bitshares Elastic Search 增加 Kibana</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-10-11 00:00:00" itemprop="dateCreated datePublished" datetime="2019-10-11T00:00:00+08:00">2019-10-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="/upload/20191011/bsLKuXdNVZ5I3DiMSwWsWHrYE3z6ygCvtTua60Zw.jpeg"></p>
<p>继上篇文章<a target="_blank" rel="noopener" href="https://steemit.com/cn/@ety001/bitshares-elasticsearch-docker-compose">《重写了我的bitshares-elasticsearch的docker-compose》</a>之后，经过一天的调试，我又增加了 <code>Kibana</code> 的配置到 <code>docker-compose.yml</code> 文件中。</p>
<p>使用方法很简单，首先停止所有容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose down</span><br></pre></td></tr></table></figure>

<p>然后备份下你之前的密码，再更新代码仓库到最新。</p>
<p>之后，修改 <code>kibana.yml</code> 文件中的 <code>elasticsearch.password</code> 为你的 <code>elastic</code> 密码。</p>
<p>如果你想要直接暴露 <code>Kibana</code> 的管理端口，可以修改 <code>docker-compose.yml</code> 文件，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">kibana:</span><br><span class="line">    container_name: kibana</span><br><span class="line">    image: docker.elastic.co/kibana/kibana:7.4.0</span><br><span class="line">    volumes:</span><br><span class="line">      - ./kibana.yml:/usr/share/kibana/config/kibana.yml</span><br><span class="line">    networks:</span><br><span class="line">      esnet:</span><br><span class="line">        ipv4_address: 172.22.0.5</span><br><span class="line">    #ports:               # 去掉这里的注释即可直接暴露端口</span><br><span class="line">    #  - 5601:5601        # 去掉这里的注释即可直接暴露端口</span><br></pre></td></tr></table></figure>

<p>最后，启动所有容器即可，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<p>目前，我已经在我的节点上配置了开放用户，</p>
<blockquote>
<p>URL: <a target="_blank" rel="noopener" href="https://bts-es.liuye.tech/">https://bts-es.liuye.tech/</a><br>Username: bts<br>Password: btsbts  </p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2019/10/10/rewrite-bitshares-docker-es-node.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/10/10/rewrite-bitshares-docker-es-node.html" class="post-title-link" itemprop="url">重写了我的bitshares-elasticsearch的docker-compose</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-10-11 00:00:00" itemprop="dateCreated datePublished" datetime="2019-10-11T00:00:00+08:00">2019-10-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="https://cdn.steemitimages.com/DQmSWLDEXYtzT8XP4Geq549MY2415EC9JRSsN7VwcMW4wxq/OlGLOj5UsS2Ms4mf4wfRQMZWWQwmD2Uoeu6lIuaj.png" alt="OlGLOj5UsS2Ms4mf4wfRQMZWWQwmD2Uoeu6lIuaj.png"></p>
<p>之前在<a href="/2019/07/15/bitshares-es-node.html">《用 docker compose 搭建 bitshares elastic search》</a>中已经介绍了如何使用<code>docker-composer</code>搭建 <code>Bitshares Elastic Search 服务</code>。</p>
<p>最近有些时间，就对之前的部署进行了优化，并且升级了 <code>elastic search</code> 的版本和 <code>Bitshares</code> 的版本。</p>
<p><strong>仓库地址(Repository)</strong> &#x3D;&gt; <a target="_blank" rel="noopener" href="https://github.com/ety001/dockerfile/tree/master/bts-es">https://github.com/ety001/dockerfile/tree/master/bts-es</a></p>
<p><strong>Manual in English</strong> &#x3D;&gt; <a target="_blank" rel="noopener" href="https://github.com/ety001/dockerfile/blob/master/bts-es/README.md">https://github.com/ety001/dockerfile/blob/master/bts-es/README.md</a></p>
<h2 id="如何部署"><a href="#如何部署" class="headerlink" title="如何部署"></a>如何部署</h2><h3 id="1-克隆代码库"><a href="#1-克隆代码库" class="headerlink" title="1. 克隆代码库"></a>1. 克隆代码库</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/ety001/dockerfile.git</span><br><span class="line">$ cd dockerfile/bts-es</span><br></pre></td></tr></table></figure>

<h3 id="2-修改-docker-composer-yaml-中的部分参数"><a href="#2-修改-docker-composer-yaml-中的部分参数" class="headerlink" title="2. 修改 docker-composer.yaml 中的部分参数"></a>2. 修改 docker-composer.yaml 中的部分参数</h3><ul>
<li><strong>ES_JAVA_OPTS&#x3D;-Xms3g -Xmx3g</strong> 这里可以调整 es 的内存占用</li>
<li><strong>ELASTIC_PASSWORD</strong> 这是你的es密码. 请同时修改 <code>--elasticsearch-basic-auth</code> 的值</li>
<li><strong>#ports: - 9200:9200</strong>, 如果你想直接让http服务可以被访问，可以取消这个地方的注释</li>
</ul>
<h3 id="3-生成证书"><a href="#3-生成证书" class="headerlink" title="3. 生成证书"></a>3. 生成证书</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ docker run \</span><br><span class="line">    -it --rm \</span><br><span class="line">    -v $(pwd)/ssl:/usr/share/elasticsearch/config/certs \</span><br><span class="line">    docker.elastic.co/elasticsearch/elasticsearch:7.4.0 \</span><br><span class="line">    /bin/bash</span><br><span class="line"></span><br><span class="line">-- 进入临时容器 --</span><br><span class="line"></span><br><span class="line"># elasticsearch-certutil ca</span><br><span class="line">ENTER ENTER （两次回车）</span><br><span class="line"></span><br><span class="line"># elasticsearch-certutil cert --ca elastic-stack-ca.p12</span><br><span class="line">ENTER ENTER ENTER （三次回车）</span><br><span class="line"></span><br><span class="line"># mv *.p12 config/certs/</span><br><span class="line"># chown 1000:1000 config/certs/*.p12</span><br><span class="line"></span><br><span class="line"># exit</span><br></pre></td></tr></table></figure>

<h3 id="4-增加-vm-max-map-count-配置"><a href="#4-增加-vm-max-map-count-配置" class="headerlink" title="4. 增加 vm.max_map_count 配置"></a>4. 增加 vm.max_map_count 配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sysctl -w vm.max_map_count=262144</span><br></pre></td></tr></table></figure>
<p>如果想要永久修改这个配置值，在 <code>/etc/sysctl.conf</code> 中增加 <code>vm.max_map_count</code> 设置。<br>配置好需要重启，执行 <code>sysctl vm.max_map_count</code> 检查是否配置成功。</p>
<h3 id="5-启动"><a href="#5-启动" class="headerlink" title="5. 启动"></a>5. 启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose up -d</span><br></pre></td></tr></table></figure>

<h2 id="其他常用命令"><a href="#其他常用命令" class="headerlink" title="其他常用命令"></a>其他常用命令</h2><h3 id="1-检查运行日志"><a href="#1-检查运行日志" class="headerlink" title="1. 检查运行日志"></a>1. 检查运行日志</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose logs -f --tail 100</span><br></pre></td></tr></table></figure>

<h3 id="2-停止所有容器"><a href="#2-停止所有容器" class="headerlink" title="2. 停止所有容器"></a>2. 停止所有容器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker-compose down</span><br></pre></td></tr></table></figure>

<h3 id="3-检查es是否成功运行"><a href="#3-检查es是否成功运行" class="headerlink" title="3. 检查es是否成功运行"></a>3. 检查es是否成功运行</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -u elastic:123456 -X GET &#x27;http://172.22.0.2:9200/_cat/health&#x27;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>123456</code> 是你在 <code>docker-compose.yml</code> 中配置的密码.</p>
</blockquote>
<h3 id="4-把-es01-加入到-nginx-的容器网络中"><a href="#4-把-es01-加入到-nginx-的容器网络中" class="headerlink" title="4. 把 es01 加入到 nginx 的容器网络中"></a>4. 把 es01 加入到 nginx 的容器网络中</h3><p>如果你同时使用 <code>docker</code> 来部署 <code>nginx</code>，你可以把 <code>es01</code> 容器加入到 <code>nginx</code> 容器<br>所在的网络里，这样可以方便 <code>nginx</code> 做反向代理到 <code>es</code> 的 <code>http</code> 服务并加上证书。</p>
<blockquote>
<p>假设你的 nginx 容器所在网络名为 lnmp</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network connect --ip 172.20.0.3 lnmp es01</span><br></pre></td></tr></table></figure>

<h2 id="任何问题？"><a href="#任何问题？" class="headerlink" title="任何问题？"></a>任何问题？</h2><p>如果有任何问题，欢迎提 issue。</p>
<p>My bitshares account: <strong>ety001</strong><br>My witness account: <strong>liuye</strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2019/10/03/bitshares-pricefeed-docker.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/10/03/bitshares-pricefeed-docker.html" class="post-title-link" itemprop="url">封装了一个Bitshares的喂价程序</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-10-04 00:00:00" itemprop="dateCreated datePublished" datetime="2019-10-04T00:00:00+08:00">2019-10-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近 <a target="_blank" rel="noopener" href="http://gbacenter.org/">GBAC</a> 计划参与 Bitshares 的见证人竞选，而我负责见证人服务节点等一系列服务的搭建。</p>
<p>一个见证人，最好是配备2台节点服务器（主备），1台测试节点服务器，1个API节点服务器，1个喂价程序。</p>
<p>其中像API和测试节点为了省成本，可以跟备机一块。最让我头疼的就是喂价程序了。</p>
<p>找了两个老的开源的喂价程序，折腾了一整天，总是各种各样的报错，最后@abit 提供了一个 <a target="_blank" rel="noopener" href="https://github.com/Zapata/bitshares-pricefeed">https://github.com/Zapata/bitshares-pricefeed</a> ，最终终于打包成可用的 docker 镜像了。</p>
<p>目前已经<a target="_blank" rel="noopener" href="https://github.com/Zapata/bitshares-pricefeed/pull/9">提交 PR 给原库</a>了，不过还没有合并。目前想要使用的话，可以先用我的库，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/ety001/bitshares-pricefeed.git</span><br><span class="line">cd bitshares-pricefeed</span><br><span class="line">git checkout develop</span><br><span class="line">docker build -t bitshares-pricefeed .</span><br></pre></td></tr></table></figure>

<p>打包好以后，镜像大约在250MB左右，比原作者的1G多的镜像小了很多。</p>
<p>使用前，先生成默认配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm -v /path/to:/app bitshares-pricefeed:latest bitshares-pricefeed create</span><br></pre></td></tr></table></figure>

<p>执行后，在 <code>/path/to</code> 目录下会有一个 <code>config.yml</code> 的配置文件，里面的注释解释的比较清楚，自己看一下就好。</p>
<p>然后执行下面的命令即可启动喂价程序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v /path/to/config.yml:/config/config.yml bitshares-pricefeed:latest bitshares-pricefeed --configfile /config/config.yml --node wss://ws.gdex.top update --active-key=XXXXXXX</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其中 active-key 就是你的见证人账号的 active 权限的私钥</p>
</blockquote>
<p>简单来说，就是简单的两步，创建配置文件，启动喂价程序。</p>
<p>不得不说，现在我对于docker的依赖越来越严重了。。。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2019/07/14/bitshares-es-node.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/07/14/bitshares-es-node.html" class="post-title-link" itemprop="url">用 docker compose 搭建 bitshares elastic search</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-07-15 00:00:00" itemprop="dateCreated datePublished" datetime="2019-07-15T00:00:00+08:00">2019-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>怕是这是第一篇中文说如何部署 <code>bitshares elastic search</code> 的文章吧。</p>
</blockquote>
<h1 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h1><ul>
<li>docker</li>
<li>elastic search</li>
</ul>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h2 id="安装-docker-和-docker-compose"><a href="#安装-docker-和-docker-compose" class="headerlink" title="安装 docker 和 docker-compose"></a>安装 docker 和 docker-compose</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># 这里只给出centos7的安装步骤</span><br><span class="line"># 其他系统请参考docker的官方文档  [https://docs.docker.com/install/]</span><br><span class="line"></span><br><span class="line"># 安装 docker</span><br><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-selinux \</span><br><span class="line">                  docker-engine-selinux \</span><br><span class="line">                  docker-engine \</span><br><span class="line">&amp;&amp; yum install -y yum-utils \</span><br><span class="line">  device-mapper-persistent-data \</span><br><span class="line">  lvm2 \</span><br><span class="line">&amp;&amp; yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo \</span><br><span class="line">&amp;&amp; yum install -y docker-ce \</span><br><span class="line">&amp;&amp; systemctl enable docker \</span><br><span class="line">&amp;&amp; systemctl start docker</span><br><span class="line"></span><br><span class="line"># 安装 docker-compose</span><br><span class="line">yum install epel-release \</span><br><span class="line">    &amp;&amp; yum install -y python-pip \</span><br><span class="line">    &amp;&amp; pip install docker-compose \</span><br><span class="line">    &amp;&amp; yum upgrade python*</span><br></pre></td></tr></table></figure>

<h2 id="拉取dockerfile"><a href="#拉取dockerfile" class="headerlink" title="拉取dockerfile"></a>拉取dockerfile</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/ety001/dockerfile.git</span><br><span class="line"></span><br><span class="line"># 切换到相关目录</span><br><span class="line">cd dockerfile/bts-es</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这是我自己用来存储常用的 <code>dockerfile</code> 的库</p>
</blockquote>
<h2 id="编译-Bitshares-内核"><a href="#编译-Bitshares-内核" class="headerlink" title="编译 Bitshares 内核"></a>编译 Bitshares 内核</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 编译 3.1.0，如果编译其他版本，自行更换版本号即可</span><br><span class="line">docker-compose build --build-arg TAG=3.1.0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>编译速度取决于你的网速和机器配置。</p>
<ul>
<li>如果在国内，可以打开该目录下的 <code>Dockerfile</code>，把其中的替换 <code>sources.list</code> 的步骤取消注释，这样更新系统软件的时候，可以使用国内163的源。</li>
<li>另外 <code>Dockerfile</code> 文件中也可以调整编译参数利用多核性能提高编译速度。</li>
</ul>
</blockquote>
<h2 id="修改系统配置"><a href="#修改系统配置" class="headerlink" title="修改系统配置"></a>修改系统配置</h2><p>向 <code>/etc/sysctl.conf</code> 中增加 <code>vm.max_map_count = 262144</code>。 <code>elasticsearch</code>要求 <code>max_map_count</code> 最低 262144。添加后，重新载入 <code>sysctl --system</code></p>
<h1 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h1><p>启动前，需要修改<code>docker-compose.yml</code>中的 <code>Xms</code> 和 <code>Xmx</code>环境变量，代表 <code>es</code> 的最小内存和最大内存占用。我的文件默认配置的是 <code>6G</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>
<blockquote>
<p>需要在 <code>docker-compose.yml</code> 文件所在目录执行该命令。</p>
</blockquote>
<h1 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose down</span><br></pre></td></tr></table></figure>
<blockquote>
<p>需要在 <code>docker-compose.yml</code> 文件所在目录执行该命令。</p>
</blockquote>
<h1 id="验证es是否启动成功"><a href="#验证es是否启动成功" class="headerlink" title="验证es是否启动成功"></a>验证es是否启动成功</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://127.0.0.1:9200/_cat/health</span><br></pre></td></tr></table></figure>

<h1 id="验证是否有数据"><a href="#验证是否有数据" class="headerlink" title="验证是否有数据"></a>验证是否有数据</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET &#x27;http://localhost:9200/bitshares-*/data/_count?pretty=true&#x27; -H &#x27;Content-Type: application/json&#x27; -d &#x27;</span><br><span class="line">&#123;</span><br><span class="line">        &quot;query&quot; : &#123;</span><br><span class="line">                &quot;bool&quot; : &#123; &quot;must&quot; : [&#123;&quot;match_all&quot;: &#123;&#125;&#125;] &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<h1 id="已知问题"><a href="#已知问题" class="headerlink" title="已知问题"></a>已知问题</h1><ul>
<li>默认用户密码未修改</li>
</ul>
<h1 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h1><ul>
<li><a target="_blank" rel="noopener" href="https://dev.bitshares.works/en/master/supports_dev/elastic_search_plugin.html">https://dev.bitshares.works/en/master/supports_dev&#x2F;elastic_search_plugin.html</a></li>
</ul>
<hr>
<h1 id="UPDATE"><a href="#UPDATE" class="headerlink" title="UPDATE"></a>UPDATE</h1><ul>
<li>修改密码的话，只需要在 <code>docker-compose.yml</code> 的 <code>elasticsearch</code> 中增加 <code>ELASTIC_PASSWORD=123456</code> 环境变量，这样启动后，密码就是 <code>123456</code>。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2019/06/21/client-server-type-ddns-for-cloudflare.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/06/21/client-server-type-ddns-for-cloudflare.html" class="post-title-link" itemprop="url">自己实现了一个cs类型的ddns更新</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-06-22 00:00:00" itemprop="dateCreated datePublished" datetime="2019-06-22T00:00:00+08:00">2019-06-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近家里的服务器的 <code>cloudflare</code> 的 <code>DDNS</code> 更新功能总是不灵验，估计问题是跟墙有关吧。</p>
<p>不得不说这种基础设施还是得自己开发。</p>
<p>考虑到有墙的原因，所以实现更新IP的思路就是，本地获取公网IP，然后发送到墙外的服务器。<br>然后墙外的服务器拿到IP后再更新 <code>cloudflare</code>。</p>
<p>获取并转发公网IP的代码：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ety001/dockerfile/tree/master/transfer_ip">https://github.com/ety001/dockerfile/tree/master/transfer_ip</a></p>
<p>获取到IP并更新的代码：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ety001/dockerfile/tree/master/update-ip-to-cloudflare">https://github.com/ety001/dockerfile/tree/master/update-ip-to-cloudflare</a></p>
<p>为了方便使用，我还封装成了 <code>Docker</code> 镜像，分别是： <code>ety001/transfer_ip</code> 和 <code>ety001/update-ip-to-cloudflare</code>。</p>
<p>使用方法如下：</p>
<p>假如你要更新的域名是 <code>abc.ppp.com</code>，先在墙外的服务器(1.1.1.1)上部署，命令是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --name update-cloudflare --restart always \</span><br><span class="line">    -p 8888:80</span><br><span class="line">    -e &quot;EMAIL=xxxxxxxx@yyyyyyy.com&quot; \</span><br><span class="line">    -e &quot;AUTH_KEY=xxxxxxxxxxxxxxxx&quot; \</span><br><span class="line">    ety001/update-ip-to-cloudflare:latest</span><br></pre></td></tr></table></figure>

<p>其中环境变量 <code>EMAIL</code> 是 <code>cloudflare</code> 的 <code>email</code>，<code>AUTH_KEY</code> 是 <code>cloudflare</code> 的 <code>API KEY</code>。</p>
<p>部署好这个后，你就可以通过 <code>http://1.1.1.1:8888/?domain=ppp.com&amp;record=abc.ppp.com&amp;ip=</code> 地址更新IP地址了。</p>
<p>然后在墙内的服务器上执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --name send-ip --restart always \</span><br><span class="line">    -e &quot;TO_URL=http://1.1.1.1:8888/?domain=ppp.com&amp;record=abc.ppp.com&amp;ip=&quot; \</span><br><span class="line">    -e &quot;IP_URL=https://api.ipify.org/&quot; \</span><br><span class="line">    ety001/transfer_ip:latest</span><br></pre></td></tr></table></figure>

<p>这里面的两个环境变量，<code>TO_URL</code> 就是墙外服务器的更新IP的地址，<code>IP_URL</code> 是可以返回你公网IP的网址。</p>
<p>这样两个容器跑起来以后，你就可以本地获取公网IP传到墙外服务器，然后再更新DNS了。</p>
<p>如果你想再更新一个新的地址，只需要在本地再启动一个容器，然后手动修改下 <code>TO_URL</code> 参数配置即可。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/8/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/49/">49</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/10/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2009 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">ETY001</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/ety001" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
