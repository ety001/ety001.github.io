<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/img/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon.ico">
  <link rel="mask-icon" href="/img/favicon.ico" color="#222">
  <link rel="manifest" href="/site.webmanifest">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.akawa.ink","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.19.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="ETY001的博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Akawa">
<meta property="og:url" content="https://blog.akawa.ink/page/7/index.html">
<meta property="og:site_name" content="Akawa">
<meta property="og:description" content="ETY001的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ETY001">
<meta property="article:tag" content="ETY001, akawa, php, vuejs, javascript, docker, steemit, bitshares">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.akawa.ink/page/7/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/7/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Akawa - ETY001的博客</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-60YZJHHP9K"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-60YZJHHP9K","only_pageview":false,"measure_protocol_api_secret":null}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>







<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7536831447654223" crossorigin="anonymous"></script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Akawa" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Akawa</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">ETY001的博客</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-首页"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-生活"><a href="/life" rel="section"><i class="fa fa-bicycle fa-fw"></i>生活</a></li><li class="menu-item menu-item-关于"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-dm实验室"><a href="/lab/" rel="section"><i class="fa fa-gear fa-fw"></i>DM实验室</a></li><li class="menu-item menu-item-捐助"><a href="/donate/" rel="section"><i class="fa fa-star fa-fw"></i>捐助</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-标签云"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签云</a></li><li class="menu-item menu-item-归档"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-友链"><a href="/friendsblog/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ETY001"
      src="/img/logo.jpg">
  <p class="site-author-name" itemprop="name">ETY001</p>
  <div class="site-description" itemprop="description">ETY001的博客</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">482</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">68</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ety001" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ety001" rel="noopener me" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:work@akawa.ink" title="E-Mail → mailto:work@akawa.ink" rel="noopener me" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/ety001" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;ety001" rel="noopener me" target="_blank"><i class="weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/ety001" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;ety001" rel="noopener me" target="_blank"><i class="twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2020/03/08/how-to-protect-blockchain-company-asset.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/03/08/how-to-protect-blockchain-company-asset.html" class="post-title-link" itemprop="url">区块链公司该如何保护自己的资产</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-03-09 00:00:00" itemprop="dateCreated datePublished" datetime="2020-03-09T00:00:00+08:00">2020-03-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近币圈的一个事情闹的动静还是不小的，就是Tron收购Steemit这个事情。这个事情现在还没有结束，我觉得还是要引起想在区块链这个领域做事情的公司关注的。</p>
<p>对于这个事情的大概前因后果，<a target="_blank" rel="noopener" href="https://steemit.com/cn/@oflyhigh/steem-a9c7ff5100" title="在这篇大佬写的文章里介绍了">在这篇大佬写的文章里介绍了</a>，这里就不再细说。大概就是Steemit公司自己经营问题导致的一些历史遗留问题，在Tron收购的时候，Ned（Steemit公司CEO）并没有交代清楚，导致Tron的老板孙宇晨在做一些宣传事项的时候，触动了Steem社区的利益集团的神经，因为沟通不是很有效，社区直接封锁了原Steemit公司的账号的资金使用权利，孙老板联合交易所又来了一个猛烈的反击，最终导致对战开始。</p>
<p>这次的事件，我觉得对于想要基于区块链进行创业的团队来说，很具有教科书式的启发。那就是在区块链上，如果引入了社区治理（比如像DPOS这样的），如何才能划清楚公司和社区的责任和财产，如何才能保护好自己？</p>
<p>在现实生活中，国家都有相对比较完备的民事法律体系，来帮助有争端的人来解决争端。那么在区块链世界，用什么来保护呢？</p>
<p>我曾在社区跟另外一个人讨论过，关于口头承诺在区块链世界到底作不作数的问题。我个人倾向于这种东西是不作数的。区块链从比特币开始，我觉得它的本质就是要用客观的方法去解决客观的问题，不要在客观问题的执行上，让人参与。</p>
<p>那么什么是客观的方法呢？代码！代码就是区块链的一切，代码就是区块链里的法律。只有在代码产生前的所有讨论，才是人可以去主观影响的。一旦多数人达成了共识，就应该用代码的方式去落实共识。当遇到纠纷的时候，就是要靠已执行在链上的代码，来保证所有人的权益。这才应该是区块链的意义。</p>
<p>就像这次的事件，核心就是币权归属的问题。Ned在跟社区协商中，对于这些资产达成了共识，但是仅是发布视频和文件在区块链上而已，而实际的币权操作还是他自己说了算的，并没有代码去限制。</p>
<p>也就说，Ned完全可以撕破脸去做他想做的事情，最多就是社区声讨吧。但是对于一个可以最后撕破脸的人来说，你觉得他会怕声讨吗？不过Ned并没有去撕破脸，而是成功套现把锅甩给了之前不明真相的孙老板。</p>
<p>如果一开始，共识达成后，就直接落实为代码，就不会有现在这难解的扣了。</p>
<p>所以说，想要在区块链方向上创业的公司，请一定要把该做的事情做好，哪怕那个时候做起来觉得繁琐没必要，也一定要做。多一份保障就是对自己财产多一份保障。</p>
<p>下面是我针对这次事件的其他吐槽（先声明我不是给孙老板站队）。</p>
<p>这个资产问题在Steem链正式运营的时候就存在，到现在至少两年的时间了，社区的领袖们（头部见证人们）都去做什么了，就跟隐形了一样。为什么在孙老板收购Steemit后，你们却都跳出来了，还直接就封锁了Steemit公司账号的币权？</p>
<p>假如说社区的人多数都认可Ned发表的口头承诺，所以没有用代码限制公司的账号币权，那么为什么孙老板收购Steemit公司后，你们就不再认可Ned的口头承诺了呢？因为这个承诺理论上讲是跟着收购这个事情，一并都算到了新的老板头上的。是不是有点双标了？虽然人都有双标的特性，但是目前的这种双标真的是对整个社区负责吗？我看其实是在对你们自己的自身利益负责吧？</p>
<p>再要说的就是区块链的制度之争。我想说的是，没有什么制度是完美的，关键还是要看参与制度的人。这句话什么意思？就是说，没有绝对的去中心化，只有相对的去中心化。即使是POW制度下的公链，只要钱多，依然可以中心化，所以关键还是要看公链的治理团队的水平。</p>
<p>最后，就是我觉得，如果在整个收购过程中，Ned并没有写明这些细节，比如之前做过的承诺之类的，其实孙老板可以去起诉Ned了。花了泡澡堂子的钱，结果进门却被强制只能泡个脚，这买卖肯定是不能这么干，这瘪肯定不会就这么吃的。我觉得这应该是孙老板联合交易所发起反击前的内心写照了吧。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2020/02/26/what-can-i-do-for-users.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/26/what-can-i-do-for-users.html" class="post-title-link" itemprop="url">从帮助400+用户7天重温了9000+个书签说起</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-27 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-27T00:00:00+08:00">2020-02-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>年前重新开发了我的浏览器扩展“温故知新”。“温故知新”这个扩展的目的就是在你每次打开新网页或者标签页的时候，能够随机从你的收藏夹&#x2F;书签栏里抽一个出来展示。这样利用了零碎的时间，就把你的书签栏整理了，对于书签数量巨大的用户来说，非常赞。</p>
<p>这次重新开发，除了解决老版本中的问题，提升操作体验，增加用户要求的新功能外，最重要的就是优化了数据统计功能。</p>
<p>之前由于对 Google Analytics 不熟悉，所以在事件埋点方面，设置的参照坐标很乱，导致在面板看到的数据意义不大。</p>
<p>这次优化后，只关注几个重要指标，比如获取书签操作、删除书签操作等。下面是2020年2月20日到2月26日的数据报表截图：</p>
<p><img src="https://cdn.steemitimages.com/DQmQ19UbXaLN9L7Mvp83gSdpjwh7hEa2tCBPsQKkcYg7hFj/photo_2020-02-27_12-08-23.jpg" alt="photo_2020-02-27_12-08-23.jpg"></p>
<p>图中 getbookmark_from_mini 和 getbookmark_from_full 就是获取书签的操作，remove_bookmark 就是删除书签的操作。“事件总数”就是事件发生的次数，“唯一身份事件数”可以看做是用户数。</p>
<p>可以看到在过去的7天，“温故知新”帮助了 285 + 127 位用户，重新回顾了 8888 + 448 个书签，并且有 38 个用户，删除了 95 个对他们来说没用的书签。</p>
<p>我觉得这应该算是一个让我感到振奋的事情！</p>
<p>在这个版本之前，我只能看到有多少用户在用我开发的扩展，而并不能了解到我可以帮助到他们多少？现在有了这些新的指标后，我能够看到我对于新版本付出的努力没有白费。</p>
<p>抛开数字统计，我觉得还有一个很重要的点，那就是我在开发工具时的思路也发生了变化。</p>
<p>在过去，我开发的目的就是玩或者解决自己的问题，但是现在我觉得开发出来的东西帮助到更多人，才是有意思的事情。尽管很多开发者，一起步的时候，就做到了这一点，不过我现在能意识到这一点也不算晚。</p>
<p>总结一下，数字可以帮助开发者量化自己的劳动成果。开发者需要收集各种信息，来看看可以帮助用户再做些什么。</p>
<blockquote>
<p>PS：点击【<a target="_blank" rel="noopener" href="https://creatorsdaily.com/9999e88d-0b00-46dc-8ff1-e1d311695324">这里</a>】，可以下载安装我的这个扩展，也可以去吐槽这个扩展。</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2020/02/13/fix-zip-md5-sum-diff.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/13/fix-zip-md5-sum-diff.html" class="post-title-link" itemprop="url">解决每次zip压缩后的md5不同的问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-14 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-14T00:00:00+08:00">2020-02-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近为了把新版的**<a target="_blank" rel="noopener" href="https://creatorsdaily.com/9999e88d-0b00-46dc-8ff1-e1d311695324?utm_source=vote">温故知新</a>**扩展上传到各个浏览器，真的是操碎了心了。这篇文章就来说说在通过火狐审核的时候的遇到的最棘手的问题。</p>
<p>由于我的扩展使用了 <code>webpack</code>，代码 <code>build</code> 后，没有可读性，所以火狐要求需要上传源代码，然后会进行审查。审查的步骤就是根据我提供的源代码和编译方法，审核人员编译一次，然后把编译后的代码打包，最后与我上传的压缩包比对，看是否一致。负责审查我的那位审查员，用的是 <code>Beyond Compare</code> 这个软件来检查两个压缩包是否一样。</p>
<p>最开始并没有注意到这里，审查员说他的编译结果跟我的不一样，我以为是我的开发环境对打包环境有污染。所以再次送审的时候，我是直接从 <code>github</code> 上下载的源码，重新来了一遍。结果审查结果依然是不一致。</p>
<p>于是我在本地进行测试，发现即使我在自己本地，两次编译后，用<code>zip</code>打包后的文件 <code>md5 sum</code> 都不一样。</p>
<p>WTF！</p>
<p>经过各种查询，最后确定应该是文件的 <code>metainfo</code> 导致的，看了下 <code>zip</code> 命令的参数，发现 <code>-X</code> 可以移除 <code>metainfo</code> 来打包，于是使用命令 <code>zip -r -X extension.zip dist/</code> 打包，对编译后的 <code>dist</code> 目录打包了两次，对比了下，发现终于特么的一致了。</p>
<p>既然一致了，就赶紧更新审核包和审核文案吧。就在更新过程中，我突然想到，我应该按照审核员的步骤再操作一遍，于是我又从下载源码开始来了一遍，最后惊奇的发现，这一遍生成的压缩包和上一遍的压缩包 <code>md5 sum</code> 又特么的不一样啊！！！！</p>
<p>经过各种试验后，排除了大部分的可能，最后猜测应该是文件日期导致的，毕竟前后两遍编译，经过各种排除后，只有时间这个变量了。</p>
<p>于是我用 <code>find dist | xargs touch -mt 202002110000</code> 先对编译结果强制修改文件的时间，然后再打压缩包，然后再从源码来一遍后，也修改成这个时间，再打包，最后对比两个压缩包的 <code>md5 sum</code>，终于一样了！！！！</p>
<p>最后提交审核，两天后，终于过审了！！！！！</p>
<p>对于书签巨多的人来说，我这个插件值得你去体验下~~~</p>
<p><strong>Chrome版地址</strong>：<a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/review-bookmarks/oacajkekkegmjcnccaeijghfodogjnom">https://chrome.google.com/webstore/detail/review-bookmarks/oacajkekkegmjcnccaeijghfodogjnom</a></p>
<p><strong>Firefox版地址</strong>：<a target="_blank" rel="noopener" href="https://addons.mozilla.org/zh-CN/firefox/addon/review-bookmarks/">https://addons.mozilla.org/zh-CN/firefox/addon/review-bookmarks/</a></p>
<p><strong>Microsoft Edge版地址</strong>：<a target="_blank" rel="noopener" href="https://microsoftedge.microsoft.com/addons/detail/pibjmfgfgamgohlaehhhbdkjboaopjkj">https://microsoftedge.microsoft.com/addons/detail/pibjmfgfgamgohlaehhhbdkjboaopjkj</a></p>
<p><strong>反馈</strong>：<a target="_blank" rel="noopener" href="https://creatorsdaily.com/9999e88d-0b00-46dc-8ff1-e1d311695324?utm_source=vote">https://creatorsdaily.com/9999e88d-0b00-46dc-8ff1-e1d311695324?utm_source&#x3D;vote</a></p>
<h5 id="欢迎使用，欢迎点赞！！"><a href="#欢迎使用，欢迎点赞！！" class="headerlink" title="欢迎使用，欢迎点赞！！"></a>欢迎使用，欢迎点赞！！</h5>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2020/02/07/google-analytics-api.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/02/07/google-analytics-api.html" class="post-title-link" itemprop="url">Google Analytics Api 使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-02-08 00:00:00" itemprop="dateCreated datePublished" datetime="2020-02-08T00:00:00+08:00">2020-02-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>最近在做浏览器扩展《<a target="_blank" rel="noopener" href="https://creatorsdaily.com/9999e88d-0b00-46dc-8ff1-e1d311695324?utm_source=vote">温故知新</a>》的新版本。其中，最让我头疼的就是用 <code>Google Analytics</code> 统计信息了。</p>
<p>Google 官方提供的 <code>SDK</code> 使用的话，需要外部引入 <code>SDK</code>，并且配置 <a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/contentSecurityPolicy">CSP</a>，而 <code>Firefox</code> 浏览器不允许配置 <code>CSP</code>。</p>
<p>无奈，只能自己去写一个简单的封装了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">export class GA &#123;</span><br><span class="line">  constructor(ua, cid, debug = false) &#123;</span><br><span class="line">    this.ua = ua;</span><br><span class="line">    this.cid = cid; // client id</span><br><span class="line">    this.gaApi = debug ? &#x27;https://www.google-analytics.com/debug/collect&#x27; : &#x27;https://www.google-analytics.com/collect&#x27;;</span><br><span class="line">    this.version = &#x27;1&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">  ga(t, ...items) &#123;</span><br><span class="line">    let payload = `v=$&#123;this.version&#125;&amp;tid=$&#123;this.ua&#125;&amp;cid=$&#123;this.cid&#125;`;</span><br><span class="line">    let params = [];</span><br><span class="line">    switch (t) &#123;</span><br><span class="line">      case &#x27;pageview&#x27;: // Pageview hit type</span><br><span class="line">        // dh -- Document hostname</span><br><span class="line">        // dp -- Page</span><br><span class="line">        // dt -- Title</span><br><span class="line">        params = [&#x27;dh&#x27;, &#x27;dp&#x27;, &#x27;dt&#x27;];</span><br><span class="line">        break;</span><br><span class="line">      case &#x27;event&#x27;:</span><br><span class="line">        // ec -- Event Category. Required</span><br><span class="line">        // ea -- Event Action. Required</span><br><span class="line">        // el -- Event label.</span><br><span class="line">        // ev -- Event value.</span><br><span class="line">        params = [&#x27;ec&#x27;, &#x27;ea&#x27;, &#x27;el&#x27;, &#x27;ev&#x27;];</span><br><span class="line">    &#125;</span><br><span class="line">    if (params === []) return;</span><br><span class="line">    payload = `$&#123;payload&#125;&amp;t=$&#123;t&#125;`;</span><br><span class="line">    items.forEach((v, i) =&gt; &#123;</span><br><span class="line">      payload = `$&#123;payload&#125;&amp;$&#123;params[i]&#125;=$&#123;encodeURIComponent(v)&#125;`;</span><br><span class="line">    &#125;);</span><br><span class="line">    const request = new XMLHttpRequest();</span><br><span class="line">    request.open(&#x27;POST&#x27;, this.gaApi, true);</span><br><span class="line">    request.send(payload);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const uid = &#x27;xxxx-xxxx-xxx-xxx&#x27;;</span><br><span class="line">const debug = false;</span><br><span class="line">const gaID = &#x27;UA-xxxxxx-x&#x27;;</span><br><span class="line">const gaObj = new GA(gaID, uid, debug);</span><br><span class="line">function sendEvent(eventCategory, eventAction, eventLabel = &#x27;&#x27;, eventValue = 1) &#123;</span><br><span class="line">  if (store.getters.config.ga === false) return;</span><br><span class="line">  gaObj.ga(&#x27;event&#x27;, eventCategory, eventAction, eventLabel, eventValue);</span><br><span class="line">&#125;</span><br><span class="line">// dh -- Document hostname, dp -- Page, dt -- Title</span><br><span class="line">function sendPageview(dp, dh = &#x27;&#x27;, dt = &#x27;&#x27;) &#123;</span><br><span class="line">  if (store.getters.config.ga === false) return;</span><br><span class="line">  gaObj.ga(&#x27;pageview&#x27;, dh, dp, dt);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这就是我根据<a target="_blank" rel="noopener" href="https://developers.google.com/analytics/devguides/collection/protocol/v1/devguide">官方文档</a>简单写的封装。</p>
<p><strong>这里面需要注意几个问题。</strong></p>
<p>一个是正式环境的地址是 <code>/collect</code> 而测试地址是 <code>/debug/collect</code>。这个在之前的时候，没有注意到还有测试地址，所以绕了弯路，也没有发现提交的参数错误。</p>
<p>另外一个就是在 <code>event</code> 类型中，<code>Event value</code> 必须是整型。</p>
<p>还有个小技巧，就是调试的时候，可以切换到“实时”选项卡，在那下面可以看到发送到 <code>/collect</code> 的实时数据。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2020/01/12/js-manifest-json-chrome-url-overrides.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/12/js-manifest-json-chrome-url-overrides.html" class="post-title-link" itemprop="url">用 js 控制 manifest.json 的 chrome_url_overrides</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-13 00:00:00" itemprop="dateCreated datePublished" datetime="2020-01-13T00:00:00+08:00">2020-01-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/review-bookmarks/oacajkekkegmjcnccaeijghfodogjnom">我的Chrome扩展</a>重构进度已经60%了，目前又遇到了新问题。</p>
<p>这个问题的缘由得慢慢说来。</p>
<p>我的扩展由于需要用自定义的页面替换新标签页。在我的早期版本的实现是<a target="_blank" rel="noopener" href="https://github.com/ety001/bookmark-extension/blob/5a384bd15b/js/background.js#L11">这样的</a>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chrome.tabs.onCreated.addListener(function(tab)&#123;</span><br><span class="line">  if(Mini.get_status()==&#x27;off&#x27;&amp;&amp;(tab.url==&quot;chrome://newtab/&quot;||tab.url==&quot;chrome://newtab&quot;))&#123;</span><br><span class="line">    chrome.tabs.update(tab.id, &#123;url:chrome.runtime.getURL(&#x27;show.html&#x27;)&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>也就是新建标签页的时候，用我自己的页面 URL 替换掉 Chrome 默认页面。</p>
<p>后来，Chrome 在某个版本后，新建标签页后，地址栏是空的，也就是 <code>tab.url</code> 是没有值，这就导致我之前的代码就失效了。</p>
<p>查看文档，发现正确的方法是在 <code>manifest.json</code> 中增加 <code>chrome_url_overrides</code> 这个选项，具体可以<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/override">查看这里</a>。</p>
<p>这就引入了新的问题。</p>
<p>我的扩展里原来是有一个开关的，这个开关可以控制新标签页是否显示我的自定义页面，也就是上面代码里的那个 <code>Mini.get_status() == &#39;off&#39;</code>。</p>
<p>现在用了 <code>manifest.json</code> 直接替换掉了默认页，而 <code>manifest.json</code> 是无法在扩展里修改的，同时 Chrome 没有提供相关的 API，那么如何实现这个开关就很尴尬了。</p>
<p>这个 BUG 我一直放着没有处理。</p>
<p>这次重构进行到了自定义页面重构后，这个问题就必须要解决了。</p>
<p>最终的解决方案是，监听页面更新，如果 URL 符合 <code>chrome://newtab/</code>，那么就替换成访问 <code>chrome-search://local-ntp/local-ntp.html</code>，代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">chrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) =&gt; &#123;</span><br><span class="line">  if (tab.url === &#x27;chrome://newtab/&#x27;) &#123;</span><br><span class="line">    if (store.getters.config.mini === false) &#123;</span><br><span class="line">      chrome.tabs.update(tabId, &#123; url: &#x27;chrome-search://local-ntp/local-ntp.html&#x27; &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>之所以用 <code>chrome.tabs.onUpdated</code>，有两个原因：一个是因为 <code>onCreated</code> 拿不到 URL，一个是在当前标签页，如果点击主页按钮的时候，也会进入 <code>chrome://newtab/</code>。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2020/01/09/chrome-content-script-conflict.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/09/chrome-content-script-conflict.html" class="post-title-link" itemprop="url">解决Chrome扩展content script中的css冲突</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2020-01-10T00:00:00+08:00">2020-01-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>这次重构<a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/review-bookmarks/oacajkekkegmjcnccaeijghfodogjnom">我的Chrome扩展</a>由于引入了很多新的东西，所以遇到的小问题还是挺多的。</p>
<p>比如在 <code>content script</code> 模式中，我的UI样式会被某些网站的 CSS 给影响到，以至于我的插件的 UI 显示不是预期。</p>
<p>在开发文档中，对于 <code>manifest.json</code> 中的 <code>content_scripts</code> 的 <code>CSS</code> 描述是： Optional. The list of CSS files to be injected into matching pages. These are injected in the order they appear in this array, <strong>before any DOM is constructed or displayed for the page</strong>.</p>
<p>这就是为啥 <code>Tab</code> 中网页可能会影响我的插件 UI 的原因。</p>
<p>因为我的插件的 <code>CSS</code> 早于 <code>Tab</code> 中网页的载入，这样 <code>Tab</code> 中网页里的 <code>CSS</code> 里面如果有重名的 <code>Class</code> 或者直接对 <code>HTML</code> 标签加样式，就会影响到我。</p>
<p>之前的版本，因为我是自己手写样式，且都用的 <code>div</code> 标签，所以很大程度上避免了冲突。</p>
<p>而这次重构引入了饿了么的 <code>UI</code>，所以增大了冲突的概率。我在 <code>content script</code> 中用的是 <code>notification</code> 这个组件，里面涉及到了 <code>&lt;h2 /&gt;</code>，<code>&lt;i /&gt;</code>这两个标签。有些网站是直接对这两个标签先进行样式全局设置的，这就导致在访问这些网站的时候，我的 <code>UI</code> 会受到影响。</p>
<p>目前我采用的解决方案是，把饿了么的 <code>UI</code> 库克隆到我的账号下，然后自己修改里面的代码，把 <code>&lt;h2 /&gt;</code>，<code>&lt;i /&gt;</code> 替换成别的标签，重新打包，引入我自己定义的库后，问题得到解决。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2020/01/08/chrome-content-scripts-font-face.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/08/chrome-content-scripts-font-face.html" class="post-title-link" itemprop="url">在Chrome扩展的Content Scripts中使用@font-face</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-09 00:00:00" itemprop="dateCreated datePublished" datetime="2020-01-09T00:00:00+08:00">2020-01-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在 <a href="/2020/01/07/chrome-extension-vuejs.html">《Chrome扩展中使用Vuejs》</a> 文章中，我们提到过 <code>@font-face</code> 我是用的 <code>CDN</code> 的方式来搞定的。但是用 <code>CDN</code> 的缺点就是网络不畅的时候，扩展中使用 <code>@font-face</code> 的地方显示就是个方块了。</p>
<p>为了解决这个问题，我搜索了下，找到了解决方案。</p>
<p>这里面有几个要点，一个是字体文件可以在任意页面访问到，一个是如何获取到扩展ID。</p>
<p>正常情况下，扩展的资源文件是与所有网页隔离开的，扩展相当于是在一个沙盒里面运行，如果想要在 <code>Content Scripts</code> 模式下，让 <code>JS</code> 或者 <code>CSS</code> 文件访问到扩展中的资源文件，那么就需要在 <code>manifest.json</code> 中增加配置项 <code>web_accessible_resources</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;web_accessible_resources&quot;: [&quot;fonts/*&quot;]</span><br></pre></td></tr></table></figure>

<p>就像上面这样增加配置后，我们就可以在 <code>Content Scripts</code> 模式下访问到 <code>fonts/</code> 目录下的所有资源文件了。</p>
<p>再来说下第二个问题。</p>
<p>我们知道扩展的地址结构是 <code>chrome://[扩展ID]</code>，那么我们的 <code>CSS</code> 文件中的 <code>@font-face</code> 的路径中的扩展ID该怎么获取呢？</p>
<p>通过看文档，找到了预设值 <code>__MSG_@@extension_id__</code>，这是出处：<a target="_blank" rel="noopener" href="https://developer.chrome.com/extensions/i18n#overview-predefined">https://developer.chrome.com/extensions/i18n#overview-predefined</a></p>
<p>那么我们去修改下 <code>element-variables.scss</code> 中的 <code>font-path</code> 像这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$--font-path: &#x27;chrome-extension://__MSG_@@extension_id__/fonts&#x27;;</span><br></pre></td></tr></table></figure>

<p>这样，最关键的两个问题就解决了，最后只要在 <code>webpack.config.js</code> 中需要复制的操作里，增加复制字体文件的操作即可，就像这样：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">new CopyPlugin([</span><br><span class="line">  ......</span><br><span class="line">  &#123; from: &#x27;../node_modules/element-ui/lib/theme-chalk/fonts&#x27;, to: &#x27;fonts&#x27; &#125;,</span><br><span class="line">  ......</span><br><span class="line">]),</span><br></pre></td></tr></table></figure>

<p>通过这样设置后，我们通过扩展插入到网页中的 <code>CSS</code> 文件就能直接访问到扩展中的资源文件了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2020/01/06/chrome-extension-vuejs.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/06/chrome-extension-vuejs.html" class="post-title-link" itemprop="url">Chrome扩展中使用Vuejs</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-07 00:00:00" itemprop="dateCreated datePublished" datetime="2020-01-07T00:00:00+08:00">2020-01-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="/upload/20200107/Z6QxWQWDYgazq6lewQ9A7sVeCNBXbuMYQ8VvC9Ge.png"></p>
<p>我<a target="_blank" rel="noopener" href="https://chrome.google.com/webstore/detail/review-bookmarks/oacajkekkegmjcnccaeijghfodogjnom">开发的扩展</a>四年多了，这两天终于突破了500用户数。很早就想要再进行开发了，但是无奈由于之前代码写的比较乱，并且用的 <code>jQuery</code> 去操作，很多东西开发起来还是很费劲的。</p>
<p>现在用户数已经 500 个用户了，之前用户呼声很高的功能，得花点心思搞一下了，要不就对不起这些铁杆用户了！</p>
<p>考虑再三，还是要重构。</p>
<p><code>jQuery</code> 在做一些交互少的功能的时候，还是很不错的选择。不过考虑到接下来要开发的功能的交互的复杂度，我觉得还是要引入 <code>Vuejs</code> 或者 <code>React</code>。鉴于熟练程度，我最终选择了 <code>Vuejs</code>。</p>
<p>由于我的 <code>Chrome</code> 扩展中将会使用 <code>Content Script</code>，<code>Popup Page</code>， <code>Tab Page</code>这三种形式，这就意味着，如果我要使用 <code>Vuejs</code> 的话，那么我需要用 <code>Webpack</code> 配置三个入口和三个文件。</p>
<p>不过让我修改 <code>Webpack</code> 配置还好，自己写，真的是太蛋疼了。于是，我找到了这个，<a target="_blank" rel="noopener" href="https://github.com/Kocal/vue-web-extension">https://github.com/Kocal/vue-web-extension</a> 。</p>
<p>这个 <code>Vue</code> 模板真的是太好用了，基本上把大部分的工作都做好了。</p>
<p>我们只需要按照 <code>Kocal/vue-web-extension</code> 库的文档操作，就可以完成基本的部署。</p>
<p>不过没有 <code>Content Script</code> 的支持，我们只需要自己在 <code>src</code> 目录下创建个新的目录，比如叫做 <code>content-script</code>。</p>
<p>然后创建一个入口文件 <code>content-script.js</code>，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &#x27;vue&#x27;;</span><br><span class="line">import App from &#x27;./App&#x27;;</span><br><span class="line">import store from &#x27;../store&#x27;;</span><br><span class="line"></span><br><span class="line">global.browser = require(&#x27;webextension-polyfill&#x27;);</span><br><span class="line"></span><br><span class="line">Vue.prototype.$browser = global.browser;</span><br><span class="line">Vue.use(ElementUI);</span><br><span class="line"></span><br><span class="line">/* eslint-disable no-new */</span><br><span class="line">new Vue(&#123;</span><br><span class="line">  el: &#x27;#review-bookmark&#x27;,</span><br><span class="line">  store,</span><br><span class="line">  render: h =&gt; h(App),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>再创建一个 <code>App.vue</code> 文件，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;button&gt;测试一下&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;&#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=&quot;scss&quot; scoped&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>

<p>最后创建一个用于初始化的文件 <code>cs-init.js</code>，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const reviewBookmarkDiv = document.createElement(&#x27;div&#x27;);</span><br><span class="line">reviewBookmarkDiv.id = &#x27;review-bookmark&#x27;;</span><br><span class="line">document.body.appendChild(reviewBookmarkDiv);</span><br></pre></td></tr></table></figure>

<p>创建好这三个文件后，再打开 <code>webpack.config.js</code> 文件，修改 <code>entry</code> 项如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">entry: &#123;</span><br><span class="line">  background: &#x27;./background.js&#x27;,</span><br><span class="line">  &#x27;popup/popup&#x27;: &#x27;./popup/popup.js&#x27;,</span><br><span class="line">  &#x27;tab/tab&#x27;: &#x27;./tab/tab.js&#x27;,</span><br><span class="line">  &#x27;content-script/content-script&#x27;: &#x27;./content-script/content-script.js&#x27;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就设置好了多个编译入口，最后编译的时候就会在 <code>dist</code> 文件夹下生成四个编译好的 <code>js</code> 文件。</p>
<p>再修改 <code>webpack.config.js</code> 中 <code>plugins</code> 项中的 <code>CopyPlugin</code> 如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">new CopyPlugin([</span><br><span class="line">  &#123; from: &#x27;icons&#x27;, to: &#x27;icons&#x27; &#125;,</span><br><span class="line">  &#123; from: &#x27;_locales&#x27;, to: &#x27;_locales&#x27; &#125;,</span><br><span class="line">  &#123; from: &#x27;content-script/cs-init.js&#x27;, to: &#x27;content-script/cs-init.js&#x27; &#125;,</span><br><span class="line">  &#123; from: &#x27;popup/popup.html&#x27;, to: &#x27;popup/popup.html&#x27;, transform: transformHtml &#125;,</span><br><span class="line">  &#123; from: &#x27;tab/tab.html&#x27;, to: &#x27;tab/tab.html&#x27;, transform: transformHtml &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    from: &#x27;manifest.json&#x27;,</span><br><span class="line">    to: &#x27;manifest.json&#x27;,</span><br><span class="line">    transform: content =&gt; &#123;</span><br><span class="line">      const jsonContent = JSON.parse(content);</span><br><span class="line">      jsonContent.version = version;</span><br><span class="line"></span><br><span class="line">      if (config.mode === &#x27;development&#x27;) &#123;</span><br><span class="line">        jsonContent[&#x27;content_security_policy&#x27;] = &quot;script-src &#x27;self&#x27; &#x27;unsafe-eval&#x27;; object-src &#x27;self&#x27;&quot;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      return JSON.stringify(jsonContent, null, 2);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<p>这样我们就把扩展需要的必要文件都复制进了 <code>dist</code> 目录。尤其是 <code>cs-init.js</code>。这个文件在下面会讲。</p>
<p>现在打开 <code>manifest.json</code> 文件，调整如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;__MSG_appname__&quot;,</span><br><span class="line">  &quot;description&quot;: &quot;__MSG_appdesc__&quot;,</span><br><span class="line">  &quot;version&quot;: null,</span><br><span class="line">  &quot;manifest_version&quot;: 2,</span><br><span class="line">  &quot;default_locale&quot;: &quot;en&quot;,</span><br><span class="line">  &quot;author&quot;: &quot;ETY001&quot;,</span><br><span class="line">  &quot;homepage_url&quot;: &quot;https://bm.to0l.cn/&quot;,</span><br><span class="line">  &quot;chrome_url_overrides&quot;: &#123;</span><br><span class="line">    &quot;newtab&quot;: &quot;tab/tab.html&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;icons&quot;: &#123;</span><br><span class="line">    &quot;16&quot;: &quot;icons/icon-16.png&quot;,</span><br><span class="line">    &quot;19&quot;: &quot;icons/icon-19.png&quot;,</span><br><span class="line">    &quot;38&quot;: &quot;icons/icon-38.png&quot;,</span><br><span class="line">    &quot;48&quot;: &quot;icons/icon-48.png&quot;,</span><br><span class="line">    &quot;128&quot;: &quot;icons/icon-128.png&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;browser_action&quot;: &#123;</span><br><span class="line">    &quot;default_title&quot;: &quot;__MSG_appname__&quot;,</span><br><span class="line">    &quot;default_popup&quot;: &quot;popup/popup.html&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;background&quot;: &#123;</span><br><span class="line">    &quot;scripts&quot;: [&quot;background.js&quot;],</span><br><span class="line">    &quot;persistent&quot;: false</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;content_scripts&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;matches&quot;: [&quot;*://*/*&quot;],</span><br><span class="line">      &quot;css&quot;: [&quot;content-script/content-script.css&quot;],</span><br><span class="line">      &quot;js&quot;: [&quot;content-script/cs-init.js&quot;, &quot;content-script/content-script.js&quot;],</span><br><span class="line">      &quot;run_at&quot;: &quot;document_end&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;web_accessible_resources&quot;: [&quot;tab/tab.html&quot;],</span><br><span class="line">  &quot;permissions&quot;: [&quot;activeTab&quot;, &quot;notifications&quot;, &quot;bookmarks&quot;, &quot;tabs&quot;, &quot;background&quot;, &quot;https://www.google-analytics.com/&quot;, &quot;storage&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>好了所有的文件都准备好了，接一下原理。</strong></p>
<p>通过看 <code>manifest.json</code> 的 <code>content_scripts</code>，可以看到我们引入了 <code>cs-init.js</code> 和 <code>content-script.js</code>。其中 <code>cs-init.js</code> 文件的作用就是为了能在页面里面插入一个 <code>&lt;div /&gt;</code> 作为模板的插入点，然后 <code>content-script.js</code> 就可以把相关的页面和逻辑就能插入进我们准备好的 <code>&lt;div /&gt;</code> 中去了。</p>
<p>除了 <code>Content Scripts</code> 这个坑需要自己填以外，还有一个字体库的坑也需要自己填一下。</p>
<p>由于我还使用了 <code>Element UI</code> 库，但是在测试的时候，发现 <code>font icon</code> 的库一直引入不了。最后，我用的 <code>cdn</code> 上的字体资源。</p>
<p>具体方法在 《<a target="_blank" rel="noopener" href="https://element.eleme.io/#/zh-CN/component/custom-theme#zai-xiang-mu-zhong-gai-bian-scss-bian-liang">在项目中改变 SCSS 变量</a>》这个文档中可以看到，只需要修改 <code>font-path</code> 这个参数即可，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/* 改变主题色变量 */</span><br><span class="line">$--color-primary: teal;</span><br><span class="line"></span><br><span class="line">/* 改变 icon 字体路径变量，必需 */</span><br><span class="line">$--font-path: &#x27;https://cdnjs.cloudflare.com/ajax/libs/element-ui/2.13.0/theme-chalk/fonts&#x27;;</span><br><span class="line"></span><br><span class="line">@import &#x27;~element-ui/packages/theme-chalk/src/index&#x27;;</span><br></pre></td></tr></table></figure>

<p>OK，花了两天的时间，把基础框架搭建好了！接下来就可以开始重构工作了，剩下的相对就简单了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2020/01/03/bitshares-testnet-2.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2020/01/03/bitshares-testnet-2.html" class="post-title-link" itemprop="url">快速搭建私有单节点 Bitshares Testnet（二）</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-01-04 00:00:00" itemprop="dateCreated datePublished" datetime="2020-01-04T00:00:00+08:00">2020-01-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在 <a href="/2019/11/27/bitshares-testnet-1.html">《快速搭建私有单节点 Bitshares Testnet（一）》</a> 中，讲解了如何搭建一个私有测试网络，这一篇将会讲解如何部署 Web 界面用于注册新用户，以及向新用户转账测试币。</p>
<h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><h2 id="拉取代码"><a href="#拉取代码" class="headerlink" title="拉取代码"></a>拉取代码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/ety001/bitshares-testnet-for-dapp-developers.git</span><br></pre></td></tr></table></figure>

<h2 id="编译镜像"><a href="#编译镜像" class="headerlink" title="编译镜像"></a>编译镜像</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd bitshares-testnet-for-dapp-developers</span><br><span class="line">docker build -t btfdd:latest .</span><br></pre></td></tr></table></figure>

<blockquote>
<p>你也可以直接使用我编译好的镜像，<code>docker pull ety001/btfdd:latest</code></p>
</blockquote>
<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd \</span><br><span class="line">  --restart always \</span><br><span class="line">  --name btfdd \</span><br><span class="line">  -p 3000:3000 \</span><br><span class="line">  -e PRIV_KEY=5Jxxxxxx \</span><br><span class="line">  -e API_URL=ws://192.168.0.10/ws \</span><br><span class="line">  -e CHAIN_ID=2d20869f3d925cdeb57da14dec65bbc18261f38db0ac2197327fc3414585b0c5 \</span><br><span class="line">  -e CORE_ASSET=TEST \</span><br><span class="line">  ety001/btfdd:latest</span><br></pre></td></tr></table></figure>

<p><strong>环境变量说明</strong></p>
<ul>
<li><code>PRIV_KEY</code> 是你用来作为水龙头的账号的 <code>active</code> 私钥</li>
<li><code>API_URL</code> 是你私有测试网络的地址。<strong>这里需要注意下地址是否可访问。</strong></li>
<li><code>CHAIN_ID</code> 是你私有测试网络的 <code>CHAIN_ID</code></li>
<li><code>CORE_ASSET</code> 是你私有网络的测试币名</li>
</ul>
<h2 id="访问"><a href="#访问" class="headerlink" title="访问"></a>访问</h2><p>如果一切正常，这个时候浏览器访问 <code>http://localhost:3000</code> 即可看到工具页面了。</p>
<p><img src="/upload/20200104/r8pKvKBaGy8mEqOYCTia9xCycrqyx4v9eMvWFAnl.png"></p>
<p>目前工具只提供创建账号和转账的功能。</p>
<h2 id="公共服务"><a href="#公共服务" class="headerlink" title="公共服务"></a>公共服务</h2><p>目前我也搭建了公共服务免费供大家使用，地址: <a target="_blank" rel="noopener" href="https://testnet.61bts.com/">https://testnet.61bts.com</a> 。</p>
<h1 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h1><p>如果有问题可以给我发邮件 <code>work#akawa.ink</code> 或者提交 <a target="_blank" rel="noopener" href="https://github.com/ety001/bitshares-testnet-for-dapp-developers/issues">issue</a>。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.akawa.ink/2019/12/25/bitshares-js-create-new-user-demo.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/logo.jpg">
      <meta itemprop="name" content="ETY001">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Akawa">
      <meta itemprop="description" content="ETY001的博客">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Akawa">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/12/25/bitshares-js-create-new-user-demo.html" class="post-title-link" itemprop="url">使用 bitsharesjs 库创建新用户Demo</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-12-26 00:00:00" itemprop="dateCreated datePublished" datetime="2019-12-26T00:00:00+08:00">2019-12-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-04-08 18:20:06" itemprop="dateModified" datetime="2024-04-08T18:20:06+08:00">2024-04-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>整理了一下用 <code>js-sdk</code> 创建新用户的最简单的 <code>Demo</code> 实现代码。</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">import &#123;PrivateKey, key, FetchChain, TransactionBuilder&#125; from &#x27;bitsharesjs&#x27;;</span><br><span class="line">import &#123;Apis, ChainConfig&#125; from &#x27;bitsharesjs-ws&#x27;;</span><br><span class="line"></span><br><span class="line">generateKeyFromPassword(accountName, role, password) &#123;</span><br><span class="line">  const seed = accountName + role + password;</span><br><span class="line">  const privKey = PrivateKey.fromSeed(seed);</span><br><span class="line">  const pubKey = privKey.toPublicKey().toString();</span><br><span class="line">  return &#123;privKey, pubKey&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">registerUser(username, password, registrar, referrer) &#123;</span><br><span class="line">  const privKey = &#x27;这里是用来签名数据的用户active私钥&#x27;;</span><br><span class="line">  const pKey = PrivateKey.fromWif(this.privKey);</span><br><span class="line">  const referrerPercent = 0;</span><br><span class="line">  const &#123;pubKey: ownerPubkey&#125; = generateKeyFromPassword(</span><br><span class="line">    username,</span><br><span class="line">    &#x27;owner&#x27;,</span><br><span class="line">    password</span><br><span class="line">  );</span><br><span class="line">  const &#123;pubKey: activePubkey&#125; = generateKeyFromPassword(</span><br><span class="line">    username,</span><br><span class="line">    &#x27;active&#x27;,</span><br><span class="line">    password</span><br><span class="line">  );</span><br><span class="line">  const &#123;pubKey: memoPubkey&#125; = generateKeyFromPassword(</span><br><span class="line">    username,</span><br><span class="line">    &#x27;memo&#x27;,</span><br><span class="line">    password</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  try &#123;</span><br><span class="line">    return Promise.all([</span><br><span class="line">      FetchChain(&quot;getAccount&quot;, registrar),</span><br><span class="line">      FetchChain(&quot;getAccount&quot;, referrer)</span><br><span class="line">    ]).then((res) =&gt; &#123;</span><br><span class="line">      const [chainRegistrar, chainReferrer] = res;</span><br><span class="line">      const tr = new TransactionBuilder();</span><br><span class="line">      tr.add_type_operation(&quot;account_create&quot;, &#123;</span><br><span class="line">        fee: &#123;</span><br><span class="line">          amount: 0,</span><br><span class="line">          asset_id: 0</span><br><span class="line">        &#125;,</span><br><span class="line">        registrar: chainRegistrar.get(&quot;id&quot;),</span><br><span class="line">        referrer: chainReferrer.get(&quot;id&quot;),</span><br><span class="line">        referrer_percent: referrerPercent,</span><br><span class="line">        name: username,</span><br><span class="line">        owner: &#123;</span><br><span class="line">            weight_threshold: 1,</span><br><span class="line">            account_auths: [],</span><br><span class="line">            key_auths: [[ownerPubkey, 1]],</span><br><span class="line">            address_auths: []</span><br><span class="line">        &#125;,</span><br><span class="line">        active: &#123;</span><br><span class="line">            weight_threshold: 1,</span><br><span class="line">            account_auths: [],</span><br><span class="line">            key_auths: [[activePubkey, 1]],</span><br><span class="line">            address_auths: []</span><br><span class="line">        &#125;,</span><br><span class="line">        options: &#123;</span><br><span class="line">            memo_key: memoPubkey,</span><br><span class="line">            voting_account: &quot;1.2.1&quot;,</span><br><span class="line">            num_witness: 0,</span><br><span class="line">            num_committee: 0,</span><br><span class="line">            votes: []</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      return tr.set_required_fees().then(() =&gt; &#123;</span><br><span class="line">        tr.add_signer(pKey);</span><br><span class="line">        console.log(&quot;serialized transaction:&quot;, tr.serialize());</span><br><span class="line">        tr.broadcast();</span><br><span class="line">        return true;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;).catch((err) =&gt; &#123;</span><br><span class="line">      console.log(&#x27;err:&#x27;, err);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; catch(e) &#123;</span><br><span class="line">    console.log(&#x27;unexpected_error:&#x27;, e);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">registerUser(&#x27;新用户名&#x27;, &#x27;新用户的密码&#x27;, &#x27;用来签名的用户的用户名&#x27;, &#x27;推荐用户的用户名&#x27;)；</span><br></pre></td></tr></table></figure>

<h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><blockquote>
<ul>
<li><code>registerUser</code> 函数参数中的 <code>registrar</code> 是用来签发数据的用户的用户名，函数里面的 <code>privKey</code> 是 <code>registrar</code> 的 <code>active</code> 私钥</li>
<li><code>referrerPercent</code> 是分成比例，这里注意是基于手续费的 50% 再分成。也就是 <code>referrerPercent</code> 设置为 <code>10000</code> ，则代表 <code>registrar</code> 分成 0%，<code>referrer</code> 分成 50%。</li>
<li>提交的数据中的 <code>voting_account</code> 是设置投票代理人是谁。</li>
</ul>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/49/">49</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2009 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">ETY001</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/ety001" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
